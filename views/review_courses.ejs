<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
    <script src="../assets/css/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="../assets/css/review_courses.css">
    <title>Courses</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="../assets/lib/fusioncharts/js/fusioncharts.js"></script>
    <script src="../assets/lib/fusioncharts/js/themes/fusioncharts.theme.fusion.js"></script>
</head>
<style>
    .img-profile {
        border-radius: 50%;
        width: 35px;
        margin-top: 4rem;
    }
</style>

<body>
    <div class="nav">
        <div class="sidebar">
            <img src="../assets/images/สัญลักษณ์ประจำมหาวิทยาลัยแม่ฟ้าหลวง.png" width="50,70">
            <p class="text-center" style="color: #A60303">MFU</p>
            <hr>
            <li class="mt-5"> <a href="/dashboard"><i class="bi bi-bar-chart"></i></a> </li>
            <li class="mt-4"><a href="/listcourse"><i class="bi bi-map"></i></a></li>
            <li class="mt-4"><a href="/search"><i class="bi bi-search"></i></a></li>
            <li class="mt-4"><a href="/community"><i class="bi bi-chat"></i></a></li>
            <li class="mt-4"><a href="/bookmark"><i class="bi bi-star"></i></a></li>
            <li class="mt-4"><a href="/notification"><i class="bi bi-bell"></i></a></li>
            <li class="mt-4"><a href="/history"><i class="bi bi-pencil-square"></i></li>
            <a class="btn" onclick="profile()">
                <div id="user-profile"></div>
            </a>
        </div>
    </div>
    <div class="col">
        <h1 class="head text-left" style="color: #A60303;">Course: <%= course.name %>
        </h1>
        <hr class="list">
    </div>

    <br>
    <div class="review">
        <h3>Review</h3>
    </div>
    <div class="container">
        <div class="review py-3 px-5" style="background-color: white; width: 1000px; height: 500px;">
            <form action="/submit-review" method="POST" id="review-form">
                <input type="hidden" name="course_id" value="<%= course.id %>">
                <div class="rate">
                    <p class="a">Easy to learn</p>
                    <input type="radio" id="star5_1" name="rate_easy" value="5" required />
                    <label for="star5_1">5 stars</label>
                    <input type="radio" id="star4_1" name="rate_easy" value="4" />
                    <label for="star4_1">4 stars</label>
                    <input type="radio" id="star3_1" name="rate_easy" value="3" />
                    <label for="star3_1">3 stars</label>
                    <input type="radio" id="star2_1" name="rate_easy" value="2" />
                    <label for="star2_1">2 stars</label>
                    <input type="radio" id="star1_1" name="rate_easy" value="1" />
                    <label for="star1_1">1 star</label>
                </div>
                <br><br>
                <div class="rate">
                    <p class="a">Collect points easily</p>
                    <input type="radio" id="star5_2" name="rate_collect" value="5" required />
                    <label for="star5_2">5 stars</label>
                    <input type="radio" id="star4_2" name="rate_collect" value="4" />
                    <label for="star4_2">4 stars</label>
                    <input type="radio" id="star3_2" name="rate_collect" value="3" />
                    <label for="star3_2">3 stars</label>
                    <input type="radio" id="star2_2" name="rate_collect" value="2" />
                    <label for="star2_2">2 stars</label>
                    <input type="radio" id="star1_2" name="rate_collect" value="1" />
                    <label for="star1_2">1 star</label>
                </div>
                <br><br>
                <div class="rate">
                    <p class="a">Number of open registration</p>
                    <input type="radio" id="star5_3" name="rate_registration" value="5" required />
                    <label for="star5_3">5 stars</label>
                    <input type="radio" id="star4_3" name="rate_registration" value="4" />
                    <label for="star4_3">4 stars</label>
                    <input type="radio" id="star3_3" name="rate_registration" value="3" />
                    <label for="star3_3">3 stars</label>
                    <input type="radio" id="star2_3" name="rate_registration" value="2" />
                    <label for="star2_3">2 stars</label>
                    <input type="radio" id="star1_3" name="rate_registration" value="1" />
                    <label for="star1_3">1 star</label>
                </div>
                <br><br>
                <div class="rate">
                    <p class="a">Appropriate content</p>
                    <input type="radio" id="star5_4" name="rate_content" value="5" required />
                    <label for="star5_4">5 stars</label>
                    <input type="radio" id="star4_4" name="rate_content" value="4" />
                    <label for="star4_4">4 stars</label>
                    <input type="radio" id="star3_4" name="rate_content" value="3" />
                    <label for="star3_4">3 stars</label>
                    <input type="radio" id="star2_4" name="rate_content" value="2" />
                    <label for="star2_4">2 stars</label>
                    <input type="radio" id="star1_4" name="rate_content" value="1" />
                    <label for="star1_4">1 star</label>
                </div>
                <br><br>
                <div class="rate">
                    <p class="a">Course overview</p>
                    <input type="radio" id="star5_5" name="rate_overview" value="5" required />
                    <label for="star5_5">5 stars</label>
                    <input type="radio" id="star4_5" name="rate_overview" value="4" />
                    <label for="star4_5">4 stars</label>
                    <input type="radio" id="star3_5" name="rate_overview" value="3" />
                    <label for="star3_5">3 stars</label>
                    <input type="radio" id="star2_5" name="rate_overview" value="2" />
                    <label for="star2_5">2 stars</label>
                    <input type="radio" id="star1_5" name="rate_overview" value="1" />
                    <label for="star1_5">1 star</label>
                </div>
                <div class="row">
                    <div class="col-12 d-flex align-items-center">
                        <div class="comment my-5 flex-grow-1">
                            <textarea class="form-control" id="review_detail" name="review_detail" rows="4"
                                placeholder="Write your review..."></textarea>
                        </div>
                        <div class="ps-3">
                            <button class="btn btn-link" type="submit">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                    class="bi bi-send-fill mx-4" viewBox="0 0 16 16" style="color: #A60303;">
                                    <path
                                        d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

            </form>
        </div>
    </div>
    <script src="../assets/css/load-html.js"></script>
    <script>
        $(document).ready(() => {
            const userinfo = JSON.parse(sessionStorage.getItem('userinfo'));
            console.log(userinfo)
            if (userinfo && userinfo.image) {
                $('#user-profile').html(`
                <img class="img-profile" crossorigin="anonymous" src="${userinfo.image}" alt="User Profile" referrerpolicy="no-referrer" />
            `);
            } else {
                console.log("No user image available");
                $('#user-profile').html(`<p>No profile image available.</p>`);
            }

            get_review_qty();
            get_review_chart();

        });

        const forbiddenWords = ["แย่", "บ้า", "ห่วย", "bad",];

        $('#review-form').on('submit', function (e) {
            const reviewDetail = $('#review_detail').val();
            const containsForbiddenWords = forbiddenWords.some(word => reviewDetail.includes(word));

            if (containsForbiddenWords) {
                e.preventDefault();
                Swal.fire({
                    icon: 'error',
                    title: 'You have inappropriate words.',
                    text: 'Your review contains inappropriate words. Please edit your review.',
                });
            }
        });

        function profile() {
            window.location.href = '/profile';
        }
    </script>

</body>

</html>